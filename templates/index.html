<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bullish Cloud | AI-Powered Stock Forecasts on the Cloud</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <span>Bullish Cloud</span>
            </div>
            <p class="tagline">AI-powered stock price predictions for tomorrow's market</p>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Model Selection -->
            <section class="model-section">
                <div class="card">
                    <h2><i class="fas fa-cogs"></i> Select Prediction Model</h2>
                    <div class="model-selection">
                        <div class="model-options">
                            <label class="model-option">
                                <input type="radio" name="model" value="enhanced" checked>
                                <div class="model-card">
                                    <i class="fas fa-rocket"></i>
                                    <h3>Enhanced Model</h3>
                                    <p>Uses technical indicators (RSI, MACD, Bollinger Bands) for more accurate predictions</p>
                                    <div class="model-badge">Recommended</div>
                                </div>
                            </label>
                            <label class="model-option">
                                <input type="radio" name="model" value="simple">
                                <div class="model-card">
                                    <i class="fas fa-bolt"></i>
                                    <h3>Simple Model</h3>
                                    <p>Basic price and volume analysis for quick predictions</p>
                                    <div class="model-badge">Fast</div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Input Section -->
            <section class="input-section">
                <div class="card">
                    <h2><i class="fas fa-search"></i> Analyze Stocks</h2>
                    <p class="card-description">Enter one or more stock tickers (comma-separated) to get AI-powered price predictions</p>
                    
                    <form id="prediction-form" class="prediction-form">
                        <div class="input-group">
                            <label for="tickers"><i class="fas fa-tag"></i> Stock Tickers</label>
                            <input 
                                type="text" 
                                id="tickers" 
                                name="tickers" 
                                placeholder="e.g., AAPL, MSFT, GOOGL" 
                                required
                            >
                            <small>Separate multiple tickers with commas (max 8)</small>
                        </div>
                        
                        <div class="form-footer">
                            <button type="submit" class="predict-btn" id="predict-btn">
                                <i class="fas fa-bolt"></i>
                                <span id="btn-text">Get Predictions</span>
                                <div class="spinner hidden" id="spinner"></div>
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section hidden" id="results-section">
                <div class="card">
                    <div class="results-header">
                        <h2><i class="fas fa-chart-bar"></i> Prediction Results</h2>
                        <div class="model-indicator" id="model-indicator">
                            <i class="fas fa-robot"></i>
                            <span id="model-used">Enhanced Model</span>
                        </div>
                    </div>
                    <div class="results-container" id="results-container">
                        <!-- Results will be appear here by JavaScript -->
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p><i class="fas fa-info-circle"></i> <strong>Disclaimer:</strong> Predictions are for educational purposes only. Please do not use this website for actual financial purposes.</p>
            <p class="copyright">&copy; COMP4651 Stock Prediction Website. Built for the purpose of learning and utilising cloud technologies.</p>
        </footer>
    </div>

    <script>
        // Model selection
        const modelRadios = document.querySelectorAll('input[name="model"]');
        const currentModelDisplay = document.getElementById('current-model');
        const modelIndicator = document.getElementById('model-indicator');
        const modelUsedDisplay = document.getElementById('model-used');

        modelRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                const selectedModel = this.value;
                const modelName = selectedModel === 'enhanced' ? 'Enhanced Model' : 'Simple Model';
                
                // Update displays
                
            });
        });

        // Prediction form handling
        document.getElementById('prediction-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const tickers = document.getElementById('tickers').value.trim();
            const selectedModel = document.querySelector('input[name="model"]:checked').value;
            const predictBtn = document.getElementById('predict-btn');
            const btnText = document.getElementById('btn-text');
            const spinner = document.getElementById('spinner');
            const resultsSection = document.getElementById('results-section');
            const resultsContainer = document.getElementById('results-container');
            
            if (!tickers) {
                alert('Please enter at least one stock ticker');
                return;
            }
            
            // Show loading state
            predictBtn.disabled = true;
            btnText.textContent = 'Analyzing...';
            spinner.classList.remove('hidden');
            
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tickers: tickers.split(',').map(t => t.trim().toUpperCase()),
                        model_type: selectedModel
                    })
                });
                
                const data = await response.json();
                
                // Display results
                displayResults(data);
                resultsSection.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error fetching predictions. Please try again.');
            } finally {
                // Reset button
                predictBtn.disabled = false;
                btnText.textContent = 'Get Predictions';
                spinner.classList.add('hidden');
            }
        });
        
        function displayResults(data) {
            const container = document.getElementById('results-container');
            
            if (data.error) {
                container.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>${data.error}</p>
                    </div>
                `;
                return;
            }
            
            if (!data.predictions || data.predictions.length === 0) {
                container.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>No predictions received. Please check your ticker symbols.</p>
                    </div>
                `;
                return;
            }
            
            // Update model used display
            if (data.model_used) {
                modelUsedDisplay.textContent = data.model_used;
            }
            
            container.innerHTML = `
                <div class="results-grid">
                    ${data.predictions.map(prediction => `
                        <div class="stock-card ${prediction.change >= 0 ? 'positive' : 'negative'}">
                            <div class="stock-header">
                                <h3>${prediction.ticker}</h3>
                                <div class="prediction-meta">
                                    <span class="change ${prediction.change >= 0 ? 'positive' : 'negative'}">
                                        <i class="fas fa-${prediction.change >= 0 ? 'caret-up' : 'caret-down'}"></i>
                                        ${prediction.change >= 0 ? '+' : ''}${prediction.change}%
                                    </span>
                                    <span class="method-badge">${prediction.method || 'ML'}</span>
                                </div>
                            </div>
                            <div class="price-info">
                                <div class="price-current">
                                    <span class="label">Current:</span>
                                    <span class="value">$${prediction.current_price}</span>
                                </div>
                                <div class="price-predicted">
                                    <span class="label">Predicted:</span>
                                    <span class="value">$${prediction.predicted_price}</span>
                                </div>
                            </div>
                            <div class="confidence">
                                <span class="label">Confidence:</span>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${prediction.confidence}%"></div>
                                </div>
                                <span class="confidence-value">${prediction.confidence}%</span>
                            </div>
                            ${prediction.model_used ? `
                            <div class="model-info">
                                <small>Model: ${prediction.model_used}</small>
                            </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Load model info on page load
        async function loadModelInfo() {
            try {
                const response = await fetch('/model-info');
                const data = await response.json();
                
                console.log('Model info loaded:', data);
            } catch (error) {
                console.error('Error loading model info:', error);
            }
        }

        // Load model info when page loads
        window.addEventListener('load', loadModelInfo);
    </script>
</body>
</html>